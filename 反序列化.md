

[TOC]

![1693620227188](C:\Users\86176\AppData\Roaming\Typora\typora-user-images\1693620227188.png)



_set（）：是对不存在或不可访问的变量进行赋值就会自动调用。

&：指向地址

a:数组

​	序列化·：就是为了放便数据传输

例如

![1693641546671](C:\Users\86176\AppData\Roaming\Typora\typora-user-images\1693641546671.png)

![1693641561190](C:\Users\86176\AppData\Roaming\Typora\typora-user-images\1693641561190.png)

这个就是数组序列化之后的

a:2代表a这个数组有2个对象

序列化时只保存成员变量不保存方法

![1693641817250](C:\Users\86176\AppData\Roaming\Typora\typora-user-images\1693641817250.png)

![1693647320501](C:\Users\86176\AppData\Roaming\Typora\typora-user-images\1693647320501.png)

而protected权限的变量在序列化时会有%00*%00字符，%00字符的ASCII码为0，不在is_valid函数规定的32到125的范围内。

可以将%00该为\\00

例

```
class Name{
    private $username = 'admin';
    private $password = 100;
}
 $a = new Name();
   $b = serialize($a);
   echo $b;
```



###### username和passowrd为private

?select=O:4:%22Name%22:3:{s:14:%22%00Name%00username%22;s:5:%22admin%22;s:14:%22%00Name%00password%22;i:100;}

###### strtolower():将字符串转化成小写



###### --如果存在__wakeup方法，调用 unserilize() 方法前则先调用__wakeup方法，但是序列化字符串中表示对象属性个数的值大于 真实的属性个数时会跳过__wakeup的执行

我们只需要把对象原来属性值比原来的大就行我们把1改成2

修改前:O:6:“sercet”:1:{s:12:“%00sercet%00file”;s:8:“flag.php”;}

修改后:O:6:“sercet”:2:{s:12:“%00sercet%00file”;s:8:“flag.php”;}

###### _toString函数详解

![1696474750540](C:\Users\86176\AppData\Roaming\Typora\typora-user-images\1696474750540.png)![1696474767974](C:\Users\86176\AppData\Roaming\Typora\typora-user-images\1696474767974.png)![1696474788597](C:\Users\86176\AppData\Roaming\Typora\typora-user-images\1696474788597.png)

1. ##### __call :  

规则：

mixed __call（string $name，array $arguments）
当调用类中不存在的方法时，就会调用__call();

为了更好的理解，看一下例子：

<?php
class Test{
     public function __call($method,$args){
          echo $method;
          var_dump($args);
        }   
    }  
     $ob=new Test();
     $ob->hello(1,2);
?>
上面的例子将输出：

hello

Array（

[0]=>1

[1]=>2

）

###### 2.__get() 和__set():

规则：

get :
mixed __get(string $name)
set:
void __set(string $name ,mixed $value)
__get()是访问不存在的成员变量时调用的；

__set()是设置不存在的成员变量时调用的；

为了更好的理解，看一下例子：

<?php
class Test{
       public $c=0;
       public $arr=array();
       
       public function __set($x,$y){
            echo $x . "/n";
            echo $y . "/n";
            $this->arr[$x]=$y;
        }    
        public function __get($x){
            echo "The value of $x is".$this->arr[$x];
    
        }   
} 
$a = new Test;
$a->b = 1 ;//成员变量b不存在，所以会调用__set
$a->c  = 2;//成员变量c存在，所以无任何输出
$d=$a->b;//  成员变量b不存在，所以会调用__get     
?>
上面的例子将输出：

b

1

The value of b is 1

###### php内置类

[[极客大挑战 2020\]greatphp | NSSCTF](https://www.nssctf.cn/problem/2300)

[php内置类小结_php 内部类-CSDN博客](https://blog.csdn.net/qq_61839115/article/details/130976241?ops_request_misc=%7B%22request%5Fid%22%3A%22170338556616800186537569%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fall.%22%7D&request_id=170338556616800186537569&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-10-130976241-null-null.142^v96^pc_search_result_base1&utm_term=[极客大挑战 2020]greatphp&spm=1018.2226.3001.4187)

```
class SYCLOVER {
    public $syc;
    public $lover;

    public function __wakeup(){
        if( ($this->syc != $this->lover) && (md5($this->syc) === md5($this->lover)) && (sha1($this->syc)=== sha1($this->lover)) ){
           if(!preg_match("/\<\?php|\(|\)|\"|\'/", $this->syc, $match)){
               eval($this->syc);
           } else {
               die("Try Hard !!");
           }
           
        }
    }
}

if (isset($_GET['great'])){
    unserialize($_GET['great']);
} else {
    highlight_file(__FILE__);
}

?>
```

###### php对类名大小写不敏感

也就是说，O:1:"**b**":2:{s:1:"a";O:1:"a":1:{s:4:"code";s:10:"phpinfo();";}}

可以改为小写的b

###### POST利用原生类

a=SplFileObject&b=php://filter/read=convert.base64-encode/resource=flag.php

#### _construct

创建对象（实例化对象时调用。）

[[第五空间 2021\]pklovecloud slackmoon的WriteUp-CSDN博客](https://blog.csdn.net/m0_61155226/article/details/131040996?spm=1001.2014.3001.5502)

[[第五空间 2021\]pklovecloud | NSSCTF](https://www.nssctf.cn/problem/335)

一般反序列化最后会这么写

```
if (isset($_GET['pks']))  
{
    $logData = unserialize($_GET['pks']);//这就是实例化了一个对象
    echo $logData; //将对象输出，假如$logData中有_toString()方法的话就会被调用。
} 
else 
{ 
    highlight_file(__file__); 
}
```

